const e={card:[],message:0,scene_arr:{},line_arr:[],close_arr:{},note_arr:[],item_arr:{},tip_arr:{},last_id:0,line_id:0,line_length:0,wall:1,scene:[],line:[],bag:[2],key:{door:"",next:""},boss:3,heart:3,qte:0},u=document.querySelector("#screen_ui"),B=document.querySelector("#screen_bg"),k=document.querySelector("#scene_ux"),c=document.querySelector("#scene_bg"),E=a("lines_div"),D=a("lines_btn"),T=a("lines_txt"),M=a("end_div"),$=a("end_content"),H=a("end_retry"),i=(t,n)=>{switch(c.innerHTML="",k.innerHTML="",u.innerHTML="",n?e.scene=n[t]:e.scene=e.scene_arr[t],e.scene.bg&&(c.className=e.scene.bg),e.line_arr[t]&&(e.line_length=e.line_arr[t].length),e.scene.type){case"anim":document.addEventListener("animationend",s=>{s.animationName===e.scene.bg&&(c.className="",i(e.scene.next))});break;case"line":_(t);break;case"close":e.line_length=0,_(t);break;case"view":e.last_id=t,_(t);break;case"room":e.last_id=t,c.className=`${e.scene.bg}-${e.wall}`,e.line_arr[t][e.wall]?(e.line_length=e.line_arr[t][e.wall].length,_(e.wall,e.line_arr[t])):_(t);break;case"qte":c.className=`${e.scene.bg}-${e.qte}`,_(t);break}},_=(t,n)=>{if(u.innerHTML="",n?(e.line=n[t],e.line_length=1):e.line=e.line_arr[t],e.line_length>0)T.textContent=e.line[e.line_id],E.innerHTML="",E.append(T,D),u.appendChild(E),e.line_id+=1;else switch(e.line_id=0,e.scene.type){case"line":i(e.scene.next);break;case"close":C(),se();break;case"view":delete e.line_arr[t],C(),ne();break;case"room":delete e.line_arr[t][e.wall],C(),ae();break;case"qte":delete e.line_arr[t],te(),I(),le();break}},C=()=>{let t=e.scene.ux;e.scene.type==="room"&&(t=e.scene.ux[e.wall-1]),t.forEach(n=>{if(e.bag.includes(n.item))return;const s=document.createElement("div");s.className="btns_ux",k.appendChild(s),s.style.left=n.x+"vh",s.style.top=n.y+"vh",s.style.width=n.w+"vh",s.style.height=n.h+"vh",s.style.background="blue",s.addEventListener("click",l=>{J(l,n)})})},J=(t,n)=>{switch(n.type){case"note":_(n.note,e.note_arr);break;case"close":i(n.close,e.close_arr);break;case"item":e.bag.push(n.item),t.target.style.display="none";break;case"next":n.wall&&(e.wall=n.wall),i(n.next);break}},S=a("qte_div"),F=a("qte_btn","ui_btns"),K=a("qte_bar"),R=a("qte_box"),h=a("qte_dot"),v=a("feedback","gmui_btns"),y=a("userHeart"),L=a("bossHeart");let U=0;function I(){U=Date.now(),h.className="qte_start_anim",v.textContent="Press to move on"}function V(){const t=window.getComputedStyle(h),n=t.transform,s=t.backgroundColor;h.className="",h.style.transform=n,h.style.backgroundColor=s}function Z(t,n){const s=t.getBoundingClientRect(),l=n.getBoundingClientRect();return s.left>=l.left&&s.right<=l.right}function ee(){const t=document.querySelector("#qte_bar");Z(h,t)?(v.textContent=e.tip_arr.success,e.boss-1<1?(i(e.scene.win),e.scene.item&&(e.bag,push(e.scene.item)),e.qte=0):(e.boss-=1,e.qte+=1,W("boss",L,e.boss),e.scene.mode==="fight"&&(c.className=`${e.scene.bg}-boss`))):(v.textContent=e.tip_arr.failed,e.heart-1<1?(c.className="",k.innerHTML="",k.appendChild(M),M.append($,H),$.textContent=e.tip_arr.end,H.textContent=e.tip_arr.retry):(e.heart-=1,e.scene.mode==="fight"&&(c.className=`${e.scene.bg}-heart`),W("heart",y,e.heart))),V()}function W(t,n,s){const l=n.querySelectorAll(`.${t}_icon`),d=l.length-s;if(d>0)for(let r=0;r<d;r++){const g=l[l.length-1-r];g.classList.add("heart_out_anim"),g.addEventListener("animationend",()=>{g.remove(),t==="boss"&&e.scene.mode==="run"?c.className=`${e.scene.bg}-${e.qte}`:c.className=`${e.scene.bg}-0`,I()})}else if(d<0)for(let r=0;r<Math.abs(d);r++){const g=a(t,`${t}-icon`);n.appendChild(g)}}function te(){y.innerHTML="",L.innerHTML="",e.boss=e.scene.boss,e.heart=e.scene.user;for(let t=0;t<e.heart;t++){const n=a(0,"heart_icon");y.appendChild(n)}for(let t=0;t<e.boss;t++){const n=a(0,"boss_icon");L.appendChild(n)}}D.addEventListener("click",j(()=>{e.line_length-=1,_(e.scene.id)},300));const Q=a("btn_return","ui_btns"),m=a("btn_bag","ui_btns"),X=a("btn_left","ui_btns"),A=a("btn_right","ui_btns"),ne=()=>{u.append(m)},se=()=>{u.append(Q,m)};Q.addEventListener("click",()=>{i(e.last_id)});const ae=()=>{u.append(X,A,m)};X.addEventListener("click",()=>{e.wall>1?e.wall-=1:e.wall=4,i(e.scene.id)});A.addEventListener("click",()=>{e.wall<4?e.wall+=1:e.wall=1,i(e.scene.id)});const le=()=>{R.appendChild(K),S.append(y,L,v,R,h,F),u.appendChild(S)};F.addEventListener("click",()=>ee());H.addEventListener("click",()=>{e.wall=1,i(0,e.scene_arr)});const w=a("bag_div"),f=a("bag_slots","bag_slots_close"),b=a("bag_view"),O=a("bag_slots_btn"),P=a("bag_key_btn");let N=!1,q=!1;m.addEventListener("click",j(()=>{N?B.removeChild(w):Y(),N=!N},300));const Y=()=>{w.innerHTML="",f.innerHTML="",w.append(b,f,O),e.bag.forEach((t,n)=>{const s=a(e.item_arr[t].bg,"bag_icon");s.draggable=!0,oe(s,t),f.appendChild(s),s.addEventListener("click",()=>{b.innerHTML="",b.className!==e.item_arr[t].bg?(b.className=e.item_arr[t].bg,e.item_arr[t].type==="key"&&(b.appendChild(P),e.key.door=e.item_arr[t].door,e.key.next=e.item_arr[t].next)):b.className=""})}),B.appendChild(w)};O.addEventListener("click",()=>{q?ce():re()});P.addEventListener("click",()=>{c.className===e.key.door&&(i(e.key.next),m.click())});const ce=()=>{q=!1,b.style.height="100%",f.className="bag_slots_close"},re=()=>{q=!0,b.style.height="0%",f.className="bag_slots_open"};let o=null,p=null;function oe(t,n){t.addEventListener("touchstart",function(s){q&&(o=t,p=n)}),t.addEventListener("touchmove",function(s){if(!o)return;o.style.position="absolute";var l=s.targetTouches[0];const d=parseFloat(window.getComputedStyle(o).width),r=parseFloat(window.getComputedStyle(o).height);o.style.left=l.screenX-window.innerWidth/2+d*1.2+"px",o.style.top=l.screenY-window.innerHeight/2+r*1.2+"px"}),t.addEventListener("touchend",function(s){if(!o)return;const l=Math.floor((s.changedTouches[0].pageX-f.offsetLeft)/o.offsetWidth),d=Math.max(0,Math.min(e.bag.length-1,l)),r=e.bag[p];e.bag[p]=e.bag[d],e.bag[d]=r;const g=e.bag.filter((x,z,G)=>x!==void 0&&x!==""&&G.indexOf(x)===z);e.bag=g,Y(),o=null,p=null})}function a(t,n,s){const l=document.createElement("div");return t&&(l.id=t),n&&(l.className=n),l}function j(t,n=100){let s;return(...l)=>{clearTimeout(s),s=setTimeout(()=>t.apply(this,l),n)}}export{J as click_ux,_ as new_line,i as new_scene,C as render_ux,e as user};
