import{a as z,b as W,c as oe,M as $,d as B,e as ie,f as F,g as k,h as de}from"./sound-Gwtqw6iZ.js";let e={golbal_arr:{},scene_arr:{},line_arr:[],close_arr:{},note_arr:[],last_id:0,line_id:0,line_length:0,wall:1,scene:[],line:[],bag:[0],key:{door:"",next:"",id:0},boss:0,heart:0,qte:0};const Y=document.querySelector("#screen"),u=document.querySelector("#screen_ui"),j=document.querySelector("#screen_bg"),G=document.querySelector("#scene_ux"),r=document.querySelector("#scene_bg"),J=document.querySelector("#set_btn"),m=l("pop_note"),_e=l("next_scene_btn"),Q=document.querySelector("#end_div"),be=document.querySelector("#end_content"),ge=document.querySelector("#end_share"),K=document.querySelector("#end_retry"),p=l("lines_div"),P=l("lines_btn"),X=l("lines_name"),d=(n,t)=>{var s;if(r.innerHTML="",G.innerHTML="",u.innerHTML="",x&&y.click(),t?e.scene=t[n]:e.scene=e.scene_arr[n],!!e.scene)switch(e.scene.bg&&(r.className=e.scene.bg),e.line_arr[n]&&(e.line_length=e.line_arr[n].length),e.scene.sound&&(e.scene.sound.currentTime=0,e.scene.sound.play()),e.scene.type){case"anim":V(),r.addEventListener("animationend",a=>{a.animationName===e.scene.bg&&e.scene.type==="anim"&&(r.className="",d(e.scene.next))});break;case"line":b(n);break;case"close":e.line_length=0,b(n);break;case"view":e.last_id=n,b(n);break;case"room":e.last_id=n,r.className=`${e.scene.bg}-${e.wall}`,(s=e.line_arr[n])!=null&&s[e.wall]?(e.line_length=e.line_arr[n][e.wall].length,b(e.wall,e.line_arr[n])):b(n);break;case"qte":e.qte=0,r.className=`${e.scene.bg}-0`,b(n);break;case"end":r.addEventListener("animationend",a=>{e.scene&&e.scene.type==="end"&&a.animationName===e.scene.bg&&(e.golbal_arr.now_end=e.scene.end,e.scene.scene?e.golbal_arr.now_scene=e.scene.scene:e.golbal_arr.now_scene+=1,_e.click())});break}},b=(n,t,s)=>{var a;if(u.innerHTML="",t?e.line=t[n]:e.scene.type==="room"||(e.line=e.line_arr[n]),e.line&&e.line_length>0)p.innerHTML="",p.textContent=e.line[e.line_id],s&&(X.textContent=s,p.appendChild(X)),p.appendChild(P),u.appendChild(p),e.line_id+=1,e.line_length-=1,z.currentTime="",z.play();else switch(e.line_id=0,e.scene.type){case"line":V(),d(e.scene.next);break;case"close":M(),Le();break;case"view":e.line_arr[n]&&delete e.line_arr[n],M(),ve();break;case"room":(a=e.line_arr[n])!=null&&a[e.wall]&&delete e.line_arr[n][e.wall],M(),xe();break;case"qte":e.line_arr[n]&&delete e.line_arr[n],pe(),ee(),qe();break}},M=()=>{let n=e.scene.ux;e.scene.type==="room"&&(n=e.scene.ux[e.wall-1]),n.forEach(t=>{if(t.type==="item"&&e.bag.includes(t.is))return;const s=document.createElement("div");s.className="btns_ux",G.appendChild(s),s.style.left=t.x+"vh",s.style.top=t.y+"vh",s.style.width=t.w+"vh",s.style.height=t.h+"vh",t.bg&&s.classList.add(t.bg),s.addEventListener("click",a=>{ue(a,t)})})},ue=(n,t)=>{switch(W.currentTime=0,W.play(),t.type){case"note":e.line_length=e.note_arr[t.is].length,b(t.is,e.note_arr),e.line_id=0;break;case"close":d(t.is,e.close_arr);break;case"next":t.wall&&(e.wall=t.wall),d(t.is);break;case"item":e.bag.push(t.is),I("item",e.golbal_arr.item[t.is].name),n.target.style.display="none";break;case"npc":t.name,e.line_length=e.note_arr[t.is].length,b(t.is,e.note_arr,t.name);break}},V=()=>{if(e.scene.change)e.scene.change.forEach(n=>{n.wall?n.ux==="add"?e.scene_arr[n.id].ux[n.wall-1].push(n.add):(e.scene_arr[n.id].ux[n.wall-1][n.ux].type=n.type,e.scene_arr[n.id].ux[n.wall-1][n.ux].is=n.is):n.ux==="add"?e.scene_arr[n.id].ux.push(n.add):(e.scene_arr[n.id].ux[n.ux].type=n.type,e.scene_arr[n.id].ux[n.ux].is=n.is)});else return},I=(n,t)=>{switch(Y.appendChild(m),n){case"item":m.textContent=`${t} ${e.golbal_arr.pop.item}`,oe.play();break;case"door":m.textContent=e.golbal_arr.pop.door;break}};m.addEventListener("animationend",n=>{n.animationName==="show_anim"&&Y.removeChild(m)});const A=l("qte_div"),Z=l("qte_btn","ui_btns"),fe=l("qte_bar"),O=l("qte_box"),f=l("qte_dot"),q=l("feedback","gmui_btns"),C=l("userHeart"),E=l("bossHeart");let he=0;function pe(){C.innerHTML="",E.innerHTML="",e.boss=e.scene.boss,e.heart=e.scene.user;for(let n=0;n<e.heart;n++){const t=l(0,"heart_icon");C.appendChild(t)}for(let n=0;n<e.boss;n++){const t=l(0,"boss_icon");E.appendChild(t)}}function ee(){he=Date.now(),f.className="qte_start_anim",q.textContent=e.golbal_arr.qte,$.play()}function me(){const t=window.getComputedStyle(f).transform;f.className="",f.style.transform=t}function ye(n,t){const s=n.getBoundingClientRect(),a=t.getBoundingClientRect();return s.left>=a.left&&s.right<=a.right}function we(){const n=document.querySelector("#qte_bar");ye(f,n)?(q.textContent=e.golbal_arr.success,e.boss-=1,e.qte+=1,e.scene.mode==="fight"&&(r.className=`${e.scene.bg}-heart`),U("boss",E,e.boss),F.currentTime=0,k.currentTime=0,F.play(),k.play()):(q.textContent=e.golbal_arr.failed,e.heart-=1,e.scene.mode==="fight"&&(r.className=`${e.scene.bg}-boss`),U("heart",C,e.heart),k.currentTime=0,k.play()),me()}function U(n,t,s){const a=t.querySelectorAll(`.${n}_icon`),_=a.length-s;if(_>0)for(let o=0;o<_;o++){const g=a[a.length-1-o];g.classList.add("heart_out_anim"),g.addEventListener("animationend",()=>{g.remove(),e.boss<1?(e.scene.reward&&(e.bag.push(e.scene.reward),I("item",e.golbal_arr.item[e.scene.reward].name)),d(e.scene.next),$.pause()):e.heart<1?(d(e.scene.end),$.pause()):(e.scene.mode==="run"?n==="boss"&&(r.className=`${e.scene.bg}-${e.qte}`):e.scene.mode==="fight"&&(r.className=`${e.scene.bg}-0`),ee())})}else if(_<0)for(let o=0;o<Math.abs(_);o++){const g=l(n,`${n}-icon`);t.appendChild(g)}}K.addEventListener("click",()=>{});let H=!1;J.addEventListener("click",R(()=>{ke()},300));const ke=()=>{H?Q.style.zIndex=-1:(Q.style.zIndex=1,J.style.zIndex=2,be.textContent=e.golbal_arr.end[0][0],ge.textContent=e.golbal_arr.end[0][1],K.textContent=""),H=!H},ne=l("btn_return","ui_btns"),y=l("btn_bag","ui_btns"),te=l("btn_left","ui_btns"),se=l("btn_right","ui_btns");P.addEventListener("click",R(()=>{b(e.scene.id)},300));const ve=()=>{u.append(y)},Le=()=>{u.append(ne,y)};ne.addEventListener("click",()=>{d(e.last_id),S()});const xe=()=>{u.append(te,se,y)};te.addEventListener("click",()=>{e.wall>1?e.wall-=1:e.wall=4,d(e.scene.id),S()});se.addEventListener("click",()=>{e.wall<4?e.wall+=1:e.wall=1,d(e.scene.id),S()});const qe=()=>{O.appendChild(fe),A.append(E,q,O,C,f,Z),u.appendChild(A)};Z.addEventListener("click",()=>we());const S=()=>{B.currentTime=0,B.play()},L=l("bag_div"),h=l("bag_slots","bag_slots_close"),c=l("bag_view"),T=l(0,"bag_slots_btn_close"),D=l("bag_key_btn");let x=!1,w=!1;y.addEventListener("click",R(()=>{x?(j.removeChild(L),S()):(le(),ae(),de.play()),x=!x},300));const ae=()=>{L.innerHTML="",h.innerHTML="",c.innerHTML="",c.classList="",L.append(c,h,T),e.bag.forEach((n,t)=>{const s=l(e.golbal_arr.item[n].bg,"bag_icon");s.draggable=!0,Ee(s,n),h.appendChild(s),s.addEventListener("click",()=>{w||(c.innerHTML="",D.textContent=e.golbal_arr.use,c.className!==e.golbal_arr.item[n].bg?(c.className=e.golbal_arr.item[n].bg,e.golbal_arr.item[n].type==="key"&&(c.appendChild(D),e.key.door=e.golbal_arr.item[n].door,e.key.next=e.golbal_arr.item[n].next,e.key.id=n)):c.className="")})}),j.appendChild(L)};T.addEventListener("click",()=>{w?le():Ce()});D.addEventListener("click",()=>{ie.play(),r.className===e.key.door?(d(e.key.next),e.bag=e.bag.filter(n=>n!==e.key.id),e.wall=1):I("door")});const le=()=>{w=!1,c.style.height="100%",h.className="bag_slots_close",T.classList="bag_slots_btn_close"},Ce=()=>{w=!0,c.style.height="0%",c.innerHTML="",c.classList="",h.className="bag_slots_open",T.classList="bag_slots_btn_open"};let i=null,v=null;function Ee(n,t){n.addEventListener("touchstart",function(s){w&&(i=n,v=t)}),n.addEventListener("touchmove",function(s){if(!i)return;i.style.position="absolute";var a=s.targetTouches[0];const _=parseFloat(window.getComputedStyle(i).width),o=parseFloat(window.getComputedStyle(i).height);i.style.left=a.screenX-window.innerWidth/2+_*1.2+"px",i.style.top=a.screenY-window.innerHeight/2+o*1.2+"px"}),n.addEventListener("touchend",function(s){if(!i)return;const a=Math.floor((s.changedTouches[0].pageX-h.offsetLeft)/i.offsetWidth),_=Math.max(0,Math.min(e.bag.length-1,a)),o=e.bag[v];e.bag[v]=e.bag[_],e.bag[_]=o;const g=e.bag.filter((N,ce,re)=>N!==void 0&&N!==""&&re.indexOf(N)===ce);e.bag=g,ae(),i=null,v=null})}function l(n,t,s){const a=document.createElement("div");return n&&(a.id=n),t&&(a.className=t),a}function R(n,t=100){let s;return(...a)=>{clearTimeout(s),s=setTimeout(()=>n.apply(this,a),t)}}export{ue as click_ux,K as end_retry,b as new_line,d as new_scene,_e as next_scene_btn,M as render_ux,e as user};
